# ğŸ“ CVE-2019-12973

## ğŸ” ì·¨ì•½ì  ê°œìš”

ğŸ”— **[ì»¤ë°‹ ë§í¬](https://github.com/uclouvain/openjpeg/commit/8ee335227bbcaf1614124046aa25e53d67b11ec3)** | ğŸ”— **[CVE ë§í¬](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12973)** | ğŸ”— **[CWE ë§í¬](https://cwe.mitre.org/data/definitions/400.html)**

> OpenJPEGì˜ BMP ë””ì½”ë” í•¨ìˆ˜ `bmp_read_rle8_data()`ì—ì„œ, ì¡°ì‘ëœ RLE ì••ì¶• ëª…ë ¹ê³¼ ì˜ëª»ëœ `width`, `height` ê°’ì„ í†µí•´ ë£¨í”„ ì¢…ë£Œ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šì•„ ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ëŠ” ì„œë¹„ìŠ¤ ê±°ë¶€(DoS) ì·¨ì•½ì ì…ë‹ˆë‹¤.
í•´ë‹¹ CVE íŒ¨ì¹˜ ì½”ë“œëŠ” src/bin/jp2/convertbmp.cì´ë‚˜, CVE ì„¤ëª…ì—ëŠ” opj_t1_encode_cblks function of openjp2/t1.cë¼ ëª…ì‹œë˜ì–´ ìˆìŒ. ì´ëŠ” íŒ¨ì¹˜ ê³¼ì • ì¤‘ ì»¤ë°‹ì´ ì·¨ì•½í•œ ì½”ë“œê°€ ìˆëŠ” openjp2/t1.cì— ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë¶€ì ì ˆí•œ ì…ë ¥ê°’ ê²€ì¦ì´ ìˆëŠ” convertbmp.cì— ì°íŒ ê²ƒìœ¼ë¡œ ì‚¬ë£Œë¨. convertbmp.cê°€ ì½”ë“œ íš ìƒ ì·¨ì•½ ì¡°ê±´ì„ ë³´ì™„í•˜ëŠ” ìœ„ì¹˜ì´ë¯€ë¡œ, ì›ë³¸ í•¨ìˆ˜ t1.cì— ëŒ€í•´ì„œëŠ” ë³„ë„ì˜ ì¶”ê°€ íƒì§€ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ

* **Source:** BMP íŒŒì¼ ë‚´ width, height í•„ë“œ
* **ì·¨ì•½ ì¡°ê±´:** ì‹¤ì œ ì´ë¯¸ì§€ í¬ê¸°ë³´ë‹¤ ì ì€ RLE ëª…ë ¹ ì‹œí€€ìŠ¤ë¥¼ ì œê³µ
* **Sink:** `for (cblkno = 0; cblkno < prc->cw * prc->ch; ++cblkno)` ë£¨í”„ì—ì„œ ì¢…ë£Œ ì¡°ê±´ì¸ prc->cw * prc->chì´ ë¹„í˜„ì‹¤ì ìœ¼ë¡œ ê°’ì´ ì»¤ì„œ êµ‰ì¥íˆ ë§ì€ ë°˜ë³µ ë°œìƒ

---

## íƒì§€ ê²°ê³¼ ìš”ì•½
CVE ì„¤ëª…ì— ê¸°ë°˜í•´ `bmp_read_rle8_data()` í•¨ìˆ˜ ì¤‘ì‹¬ìœ¼ë¡œ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ìˆ˜ì§‘í•œ ê²°ê³¼,

| ì´ ìŠ¬ë¼ì´ìŠ¤ ìˆ˜ | ì·¨ì•½ìœ¼ë¡œ íƒì§€ | ì •ìƒìœ¼ë¡œ íƒì§€ |
| :------: | :-----: | :-----: |
|   196ê°œ   |    0ê°œ   |   196ê°œ  |

AI ëª¨ë¸ì€ ëª¨ë‘ ì •ìƒìœ¼ë¡œ íŒì •.

| FileName             | Caller                  | Source |  Sink | idx | CWE-ID |    category    | criterion | line | label | token\_length | predict |
| :------------------- | :---------------------- | :----: | :---: | :-: | :----: | :------------: | :-------: | :--: | :---: | :-----------: | :-----: |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  0  |  CWE-  | CallExpression |    getc   |  330 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  1  |  CWE-  | CallExpression |    getc   |  331 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  2  |  CWE-  | CallExpression |  fprintf  |  334 |   -3  |       23      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  3  |  CWE-  | CallExpression |    getc   |  340 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  4  |  CWE-  | CallExpression |    getc   |  341 |   -3  |      343      |    0    |


ì´ CVE ì·¨ì•½ì ì„ ìœ ë°œí•˜ëŠ” ì½”ë“œ(sink:src/lib/openjp2/t1.c:2137, `for (cblkno = 0; cblkno < prc->cw * prc->ch; ++cblkno)`)ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
`prc->cw`ì™€ `prc->ch`ëŠ” `uint32_t` íƒ€ì…ì´ë¯€ë¡œ, `prc->cw * prc->ch`ì˜ ê²°ê³¼ë„ ìµœëŒ€ 4,294,967,295ê¹Œì§€ ì»¤ì§ˆ ìˆ˜ ìˆì–´, ì´ë§Œí¼ ë°˜ë³µì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

```c
OPJ_BOOL opj_t1_encode_cblks(opj_t1_t *t1,
                             opj_tcd_tile_t *tile,
                             opj_tcp_t *tcp,
                             const OPJ_FLOAT64 * mct_norms,
                             OPJ_UINT32 mct_numcomps
                            )
{
    OPJ_UINT32 compno, resno, bandno, precno, cblkno;

    tile->distotile = 0;        /* fixed_quality */

    for (compno = 0; compno < tile->numcomps; ++compno) {
        opj_tcd_tilecomp_t* tilec = &tile->comps[compno];
        opj_tccp_t* tccp = &tcp->tccps[compno];
        OPJ_UINT32 tile_w = (OPJ_UINT32)(tilec->x1 - tilec->x0);

        for (resno = 0; resno < tilec->numresolutions; ++resno) {
            opj_tcd_resolution_t *res = &tilec->resolutions[resno];

            for (bandno = 0; bandno < res->numbands; ++bandno) {
                opj_tcd_band_t* OPJ_RESTRICT band = &res->bands[bandno];
                OPJ_INT32 bandconst;

                /* Skip empty bands */
                if (opj_tcd_is_band_empty(band)) {
                    continue;
                }

                bandconst = 8192 * 8192 / ((OPJ_INT32) floor(band->stepsize * 8192));
                for (precno = 0; precno < res->pw * res->ph; ++precno) {
                    opj_tcd_precinct_t *prc = &band->precincts[precno];

                    for (cblkno = 0; cblkno < prc->cw * prc->ch; ++cblkno) {
```
ì´ ì½”ë“œì—ì„œ Ksign ìŠ¬ë¼ì´ì„œ ë„êµ¬ê°€ ì¶”ì¶œí–ˆì–´ì•¼ í•˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì§ì ‘ ì‘ì„±í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
```c
/* src/bin/jp2/opj_compress.c:2016 */
int main(int argc, char **argv)
{

    opj_cparameters_t parameters;   /* compression parameters */

    opj_stream_t *l_stream = 00;
    opj_codec_t* l_codec = 00;
    opj_image_t *image = NULL;
    raw_cparameters_t raw_cp;
    OPJ_SIZE_T num_compressed_files = 0;

    char indexfilename[OPJ_PATH_LEN];   /* index file name */

    unsigned int i, num_images, imageno;
    img_fol_t img_fol;
    dircnt_t *dirptr = NULL;

    int ret = 0;

    OPJ_BOOL bSuccess;
    OPJ_BOOL bUseTiles = OPJ_FALSE; /* OPJ_TRUE */
    OPJ_UINT32 l_nb_tiles = 4;
    OPJ_FLOAT64 t = opj_clock();

    /* set encoding parameters to default values */
    opj_set_default_encoder_parameters(&parameters);

    /* Initialize indexfilename and img_fol */
    *indexfilename = 0;
    memset(&img_fol, 0, sizeof(img_fol_t));

    /* raw_cp initialization */
    raw_cp.rawBitDepth = 0;
    raw_cp.rawComp = 0;
    raw_cp.rawComps = 0;
    raw_cp.rawHeight = 0;
    raw_cp.rawSigned = 0;
    raw_cp.rawWidth = 0;

    /* parse input and get user encoding parameters */
    parameters.tcp_mct = (char)
                         255; /* This will be set later according to the input image or the provided option */
    if (parse_cmdline_encoder(argc, argv, &parameters, &img_fol, &raw_cp,
                              indexfilename, sizeof(indexfilename)) == 1) {

    /* Read directory if necessary */
    if (img_fol.set_imgdir == 1) {
        num_images = get_num_images(img_fol.imgdirpath);
        dirptr = (dircnt_t*)malloc(sizeof(dircnt_t));
        if (dirptr) {
            dirptr->filename_buf = (char*)malloc(num_images * OPJ_PATH_LEN * sizeof(
                    char)); /* Stores at max 10 image file names*/
            dirptr->filename = (char**) malloc(num_images * sizeof(char*));
            if (!dirptr->filename_buf) {
            for (i = 0; i < num_images; i++) {
                dirptr->filename[i] = dirptr->filename_buf + i * OPJ_PATH_LEN;
            }
        }
        if (load_images(dirptr, img_fol.imgdirpath) == 1) {
        if (num_images == 0) {
    } else {
        num_images = 1;
    }
    /*Encoding image one by one*/
    for (imageno = 0; imageno < num_images; imageno++) {
        image = NULL;
        fprintf(stderr, "\n");

        if (img_fol.set_imgdir == 1) {
            if (get_next_file((int)imageno, dirptr, &img_fol, &parameters)) {
                fprintf(stderr, "skipping file...\n");
                continue;
            }
        }

        switch (parameters.decod_format) {
        case PGX_DFMT:
            break;
        case PXM_DFMT:
            break;
        case BMP_DFMT:
            break;
        case TIF_DFMT:
            break;
        case RAW_DFMT:
            break;
        case RAWL_DFMT:
            break;
        case TGA_DFMT:
            break;
        case PNG_DFMT:
            break;
        default:
            fprintf(stderr, "skipping file...\n");
            continue;
        }

        /* decode the source image */
        /* ----------------------- */

        switch (parameters.decod_format) {
        case PGX_DFMT:
            image = pgxtoimage(parameters.infile, &parameters);
            if (!image) {
            break;

        case PXM_DFMT:
            image = pnmtoimage(parameters.infile, &parameters);
            if (!image) {
            break;

        case BMP_DFMT:
            image = bmptoimage(parameters.infile, &parameters);
            
                /* src/lib/openjp2/openjpeg.c:819 */
                opj_image_t* bmptoimage(const char *filename, opj_cparameters_t *parameters)
                {
                    opj_image_cmptparm_t cmptparm[4];   /* maximum of 4 components */
                    OPJ_UINT8 lut_R[256], lut_G[256], lut_B[256];
                    OPJ_UINT8 const* pLUT[3];
                    opj_image_t * image = NULL;
                    FILE *IN;
                    OPJ_BITMAPFILEHEADER File_h;
                    OPJ_BITMAPINFOHEADER Info_h;
                    OPJ_UINT32 i, palette_len, numcmpts = 1U;
                    OPJ_BOOL l_result = OPJ_FALSE;
                    OPJ_UINT8* pData = NULL;
                    OPJ_UINT32 stride;

                    pLUT[0] = lut_R;
                    pLUT[1] = lut_G;
                    pLUT[2] = lut_B;

                    IN = fopen(filename, "rb");
                    if (!IN) {

                    if (!bmp_read_file_header(IN, &File_h)) {
                    if (!bmp_read_info_header(IN, &Info_h)) {

                    /* Load palette */
                    if (Info_h.biBitCount <= 8U) {
                        memset(&lut_R[0], 0, sizeof(lut_R));
                        memset(&lut_G[0], 0, sizeof(lut_G));
                        memset(&lut_B[0], 0, sizeof(lut_B));

                        palette_len = Info_h.biClrUsed;
                        if ((palette_len == 0U) && (Info_h.biBitCount <= 8U)) {
                            palette_len = (1U << Info_h.biBitCount);
                        }
                        if (palette_len > 256U) {
                            palette_len = 256U;
                        }
                        if (palette_len > 0U) {
                            OPJ_UINT8 has_color = 0U;
                            for (i = 0U; i < palette_len; i++) {
                                lut_B[i] = (OPJ_UINT8)getc(IN);
                                lut_G[i] = (OPJ_UINT8)getc(IN);
                                lut_R[i] = (OPJ_UINT8)getc(IN);
                                (void)getc(IN); /* padding */
                                has_color |= (lut_B[i] ^ lut_G[i]) | (lut_G[i] ^ lut_R[i]);
                            }
                            if (has_color) {
                                numcmpts = 3U;
                            }
                        }
                    } else {
                        numcmpts = 3U;
                        if ((Info_h.biCompression == 3) && (Info_h.biAlphaMask != 0U)) {
                            numcmpts++;
                        }
                    }

                    if (Info_h.biWidth == 0 || Info_h.biHeight == 0) {

                    if (Info_h.biBitCount > (((OPJ_UINT32) - 1) - 31) / Info_h.biWidth) {
                    stride = ((Info_h.biWidth * Info_h.biBitCount + 31U) / 32U) *
                            4U; /* rows are aligned on 32bits */
                    if (Info_h.biBitCount == 4 &&
                            Info_h.biCompression == 2) { /* RLE 4 gets decoded as 8 bits data for now... */
                        if (8 > (((OPJ_UINT32) - 1) - 31) / Info_h.biWidth) {
                        stride = ((Info_h.biWidth * 8U + 31U) / 32U) * 4U;
                    }

                    if (stride > ((OPJ_UINT32) - 1) / sizeof(OPJ_UINT8) / Info_h.biHeight) {
                    pData = (OPJ_UINT8 *) calloc(1, sizeof(OPJ_UINT8) * stride * Info_h.biHeight);
                    if (pData == NULL) {
                    /* Place the cursor at the beginning of the image information */
                    fseek(IN, 0, SEEK_SET);
                    fseek(IN, (long)File_h.bfOffBits, SEEK_SET);

                    switch (Info_h.biCompression) {
                    case 0:
                    case 3:
                        /* read raw data */
                        l_result = bmp_read_raw_data(IN, pData, stride, Info_h.biWidth,
                                                    Info_h.biHeight);
                        break;
                    case 1:
                        /* read rle8 data */
                        l_result = bmp_read_rle8_data(IN, pData, stride, Info_h.biWidth,
                                                    Info_h.biHeight);
            if (!image) {
            break;

#ifdef OPJ_HAVE_LIBTIFF
        case TIF_DFMT:
            image = tiftoimage(parameters.infile, &parameters);
            if (!image) {
            break;
#endif /* OPJ_HAVE_LIBTIFF */

        case RAW_DFMT:
            image = rawtoimage(parameters.infile, &parameters, &raw_cp);
            if (!image) {
            break;

        case RAWL_DFMT:
            image = rawltoimage(parameters.infile, &parameters, &raw_cp);
            if (!image) {
            break;

        case TGA_DFMT:
            image = tgatoimage(parameters.infile, &parameters);
            if (!image) {
            break;

#ifdef OPJ_HAVE_LIBPNG
        case PNG_DFMT:
            image = pngtoimage(parameters.infile, &parameters);
            if (!image) {
            break;
#endif /* OPJ_HAVE_LIBPNG */
        }

        /* Can happen if input file is TIFF or PNG
        * and OPJ_HAVE_LIBTIF or OPJ_HAVE_LIBPNG is undefined
        */
        if (!image) {

        /* Decide if MCT should be used */
        if (parameters.tcp_mct == (char)
                255) { /* mct mode has not been set in commandline */
            parameters.tcp_mct = (image->numcomps >= 3) ? 1 : 0;
        } else {            /* mct mode has been set in commandline */
            if ((parameters.tcp_mct == 1) && (image->numcomps < 3)) {
            if ((parameters.tcp_mct == 2) && (!parameters.mct_data)) {
        }

        /* encode the destination image */
        /* ---------------------------- */

        switch (parameters.cod_format) {
        case J2K_CFMT: { /* JPEG-2000 codestream */
            /* Get a decoder handle */
            l_codec = opj_create_compress(OPJ_CODEC_J2K);
            break;
        }

        /* catch events using our callbacks and give a local context */
        opj_set_info_handler(l_codec, info_callback, 00);
        opj_set_warning_handler(l_codec, warning_callback, 00);
        opj_set_error_handler(l_codec, error_callback, 00);

        if (bUseTiles) {
            parameters.cp_tx0 = 0;
            parameters.cp_ty0 = 0;
            parameters.tile_size_on = OPJ_TRUE;
            parameters.cp_tdx = 512;
            parameters.cp_tdy = 512;
        }
        if (! opj_setup_encoder(l_codec, &parameters, image)) {

        /* open a byte stream for writing and allocate memory for all tiles */
        l_stream = opj_stream_create_default_file_stream(parameters.outfile, OPJ_FALSE);
        if (! l_stream) {

        /* encode the image */
        bSuccess = opj_start_compress(l_codec, image, l_stream);
        if (!bSuccess)  {
            fprintf(stderr, "failed to encode image: opj_start_compress\n");
        }
        if (bSuccess && bUseTiles) {
        } else {
            bSuccess = bSuccess && opj_encode(l_codec, l_stream);

/* src/lib/openjp2/openjpeg.c:819 */
OPJ_BOOL OPJ_CALLCONV opj_encode(opj_codec_t *p_info, opj_stream_t *p_stream)
{
    if (p_info && p_stream) {
        opj_codec_private_t * l_codec = (opj_codec_private_t *) p_info;
        opj_stream_private_t * l_stream = (opj_stream_private_t *) p_stream;

        if (! l_codec->is_decompressor) {
            return l_codec->m_codec_data.m_compression.opj_encode(l_codec->m_codec,
                    l_stream,
                    &(l_codec->m_event_mgr));

/* src/lib/openjp2/openjpeg.c:629 */
opj_codec_t* OPJ_CALLCONV opj_create_compress(OPJ_CODEC_FORMAT p_format)
{
    opj_codec_private_t *l_codec = 00;

    l_codec = (opj_codec_private_t*)opj_calloc(1, sizeof(opj_codec_private_t));
    if (!l_codec) {
        return 00;
    }

    l_codec->is_decompressor = 0;

    switch (p_format) {
    case OPJ_CODEC_J2K:
        l_codec->m_codec_data.m_compression.opj_encode = (OPJ_BOOL(*)(void *,
                struct opj_stream_private *,
                struct opj_event_mgr *)) opj_j2k_encode;

/* src/lib/openjp2/j2k.c:11279 */
OPJ_BOOL opj_j2k_encode(opj_j2k_t * p_j2k,
                        opj_stream_private_t *p_stream,
                        opj_event_mgr_t * p_manager)
{
    OPJ_UINT32 i, j;
    OPJ_UINT32 l_nb_tiles;
    OPJ_SIZE_T l_max_tile_size = 0, l_current_tile_size;
    OPJ_BYTE * l_current_data = 00;
    OPJ_BOOL l_reuse_data = OPJ_FALSE;
    opj_tcd_t* p_tcd = 00;

    /* preconditions */
    assert(p_j2k != 00);
    assert(p_stream != 00);
    assert(p_manager != 00);

    p_tcd = p_j2k->m_tcd;

    l_nb_tiles = p_j2k->m_cp.th * p_j2k->m_cp.tw;
    if (l_nb_tiles == 1) {
        l_reuse_data = OPJ_TRUE;
#ifdef __SSE__
        for (j = 0; j < p_j2k->m_tcd->image->numcomps; ++j) {
            opj_image_comp_t * l_img_comp = p_tcd->image->comps + j;
            if (((size_t)l_img_comp->data & 0xFU) !=
                    0U) { /* tile data shall be aligned on 16 bytes */
                l_reuse_data = OPJ_FALSE;
            }
        }
#endif
    }
    for (i = 0; i < l_nb_tiles; ++i) {
        if (! opj_j2k_pre_write_tile(p_j2k, i, p_stream, p_manager)) {
            if (l_current_data) {
                opj_free(l_current_data);
            }
            return OPJ_FALSE;
        }

        /* if we only have one tile, then simply set tile component data equal to image component data */
        /* otherwise, allocate the data */
        for (j = 0; j < p_j2k->m_tcd->image->numcomps; ++j) {
            opj_tcd_tilecomp_t* l_tilec = p_tcd->tcd_image->tiles->comps + j;
            if (l_reuse_data) {
                opj_image_comp_t * l_img_comp = p_tcd->image->comps + j;
                l_tilec->data  =  l_img_comp->data;
                l_tilec->ownsData = OPJ_FALSE;
            } else {
                if (! opj_alloc_tile_component_data(l_tilec)) {
                    opj_event_msg(p_manager, EVT_ERROR, "Error allocating tile component data.");
                    if (l_current_data) {
                        opj_free(l_current_data);
                    }
                    return OPJ_FALSE;
                }
            }
        }
        l_current_tile_size = opj_tcd_get_encoded_tile_size(p_j2k->m_tcd);
        if (!l_reuse_data) {
            if (l_current_tile_size > l_max_tile_size) {
                OPJ_BYTE *l_new_current_data = (OPJ_BYTE *) opj_realloc(l_current_data,
                                               l_current_tile_size);
                if (! l_new_current_data) {
                    if (l_current_data) {
                        opj_free(l_current_data);
                    }
                    opj_event_msg(p_manager, EVT_ERROR, "Not enough memory to encode all tiles\n");
                    return OPJ_FALSE;
                }
                l_current_data = l_new_current_data;
                l_max_tile_size = l_current_tile_size;
            }
            if (l_current_data == NULL) {
                /* Should not happen in practice, but will avoid Coverity to */
                /* complain about a null pointer dereference */
                assert(0);
                return OPJ_FALSE;
            }

            /* copy image data (32 bit) to l_current_data as contiguous, all-component, zero offset buffer */
            /* 32 bit components @ 8 bit precision get converted to 8 bit */
            /* 32 bit components @ 16 bit precision get converted to 16 bit */
            opj_j2k_get_tile_data(p_j2k->m_tcd, l_current_data);

            /* now copy this data into the tile component */
            if (! opj_tcd_copy_tile_data(p_j2k->m_tcd, l_current_data,
                                         l_current_tile_size)) {
                opj_event_msg(p_manager, EVT_ERROR,
                              "Size mismatch between tile data and sent data.");
                opj_free(l_current_data);
                return OPJ_FALSE;
            }
        }

        if (! opj_j2k_post_write_tile(p_j2k, p_stream, p_manager)) {

/* src/lib/openjp2/j2k.c:11531 */
static OPJ_BOOL opj_j2k_post_write_tile(opj_j2k_t * p_j2k,
                                        opj_stream_private_t *p_stream,
                                        opj_event_mgr_t * p_manager)
{
    OPJ_UINT32 l_nb_bytes_written;
    OPJ_BYTE * l_current_data = 00;
    OPJ_UINT32 l_tile_size = 0;
    OPJ_UINT32 l_available_data;

    /* preconditions */
    assert(p_j2k->m_specific_param.m_encoder.m_encoded_tile_data);

    l_tile_size = p_j2k->m_specific_param.m_encoder.m_encoded_tile_size;
    l_available_data = l_tile_size;
    l_current_data = p_j2k->m_specific_param.m_encoder.m_encoded_tile_data;

    l_nb_bytes_written = 0;
    if (! opj_j2k_write_first_tile_part(p_j2k, l_current_data, &l_nb_bytes_written,
                                        l_available_data, p_stream, p_manager)) {

/* src/lib/openjp2/j2k.c:11773 */
static OPJ_BOOL opj_j2k_write_first_tile_part(opj_j2k_t *p_j2k,
        OPJ_BYTE * p_data,
        OPJ_UINT32 * p_data_written,
        OPJ_UINT32 p_total_data_size,
        opj_stream_private_t *p_stream,
        struct opj_event_mgr * p_manager)
{
    OPJ_UINT32 l_nb_bytes_written = 0;
    OPJ_UINT32 l_current_nb_bytes_written;
    OPJ_BYTE * l_begin_data = 00;

    opj_tcd_t * l_tcd = 00;
    opj_cp_t * l_cp = 00;

    l_tcd = p_j2k->m_tcd;
    l_cp = &(p_j2k->m_cp);

    l_tcd->cur_pino = 0;

    /*Get number of tile parts*/
    p_j2k->m_specific_param.m_encoder.m_current_poc_tile_part_number = 0;

    /* INDEX >> */
    /* << INDEX */

    l_current_nb_bytes_written = 0;
    l_begin_data = p_data;
    if (! opj_j2k_write_sot(p_j2k, p_data, p_total_data_size,
                            &l_current_nb_bytes_written, p_stream,
                            p_manager)) {
        return OPJ_FALSE;
    }

    l_nb_bytes_written += l_current_nb_bytes_written;
    p_data += l_current_nb_bytes_written;
    p_total_data_size -= l_current_nb_bytes_written;

    if (!OPJ_IS_CINEMA(l_cp->rsiz)) {
        if (l_cp->tcps[p_j2k->m_current_tile_number].numpocs) {
            l_current_nb_bytes_written = 0;
            opj_j2k_write_poc_in_memory(p_j2k, p_data, &l_current_nb_bytes_written,
                                        p_manager);
            l_nb_bytes_written += l_current_nb_bytes_written;
            p_data += l_current_nb_bytes_written;
            p_total_data_size -= l_current_nb_bytes_written;
        }
    }

    l_current_nb_bytes_written = 0;
    if (! opj_j2k_write_sod(p_j2k, l_tcd, p_data, &l_current_nb_bytes_written,
                            p_total_data_size, p_stream, p_manager)) {

/* src/lib/openjp2/j2k.c:4691 */
static OPJ_BOOL opj_j2k_write_sod(opj_j2k_t *p_j2k,
                                  opj_tcd_t * p_tile_coder,
                                  OPJ_BYTE * p_data,
                                  OPJ_UINT32 * p_data_written,
                                  OPJ_UINT32 p_total_data_size,
                                  const opj_stream_private_t *p_stream,
                                  opj_event_mgr_t * p_manager
                                 )
{
    opj_codestream_info_t *l_cstr_info = 00;
    OPJ_UINT32 l_remaining_data;

    /* preconditions */
    assert(p_j2k != 00);
    assert(p_manager != 00);
    assert(p_stream != 00);

    OPJ_UNUSED(p_stream);

    if (p_total_data_size < 4) {

    opj_write_bytes(p_data, J2K_MS_SOD,
                    2);                                 /* SOD */
    p_data += 2;

    /* make room for the EOF marker */
    l_remaining_data =  p_total_data_size - 4;

    /* update tile coder */
    p_tile_coder->tp_num =
        p_j2k->m_specific_param.m_encoder.m_current_poc_tile_part_number ;
    p_tile_coder->cur_tp_num =
        p_j2k->m_specific_param.m_encoder.m_current_tile_part_number;

    if (p_j2k->m_specific_param.m_encoder.m_current_tile_part_number == 0) {
        p_tile_coder->tcd_image->tiles->packno = 0;
#ifdef deadcode
        if (l_cstr_info) {
            l_cstr_info->packno = 0;
        }
#endif
    }

    *p_data_written = 0;

    if (! opj_tcd_encode_tile(p_tile_coder, p_j2k->m_current_tile_number, p_data,
                              p_data_written, l_remaining_data, l_cstr_info,
                              p_manager))

/* src/lib/openjp2/tcd.c:1414 */
OPJ_BOOL opj_tcd_encode_tile(opj_tcd_t *p_tcd,
                             OPJ_UINT32 p_tile_no,
                             OPJ_BYTE *p_dest,
                             OPJ_UINT32 * p_data_written,
                             OPJ_UINT32 p_max_length,
                             opj_codestream_info_t *p_cstr_info,
                             opj_event_mgr_t *p_manager)
{

    if (p_tcd->cur_tp_num == 0) {

        p_tcd->tcd_tileno = p_tile_no;
        p_tcd->tcp = &p_tcd->cp->tcps[p_tile_no];

        /* INDEX >> "Precinct_nb_X et Precinct_nb_Y" */
        if (p_cstr_info)  {
            OPJ_UINT32 l_num_packs = 0;
            OPJ_UINT32 i;
            opj_tcd_tilecomp_t *l_tilec_idx =
                &p_tcd->tcd_image->tiles->comps[0];        /* based on component 0 */
            opj_tccp_t *l_tccp = p_tcd->tcp->tccps; /* based on component 0 */

            for (i = 0; i < l_tilec_idx->numresolutions; i++) {
                opj_tcd_resolution_t *l_res_idx = &l_tilec_idx->resolutions[i];

                p_cstr_info->tile[p_tile_no].pw[i] = (int)l_res_idx->pw;
                p_cstr_info->tile[p_tile_no].ph[i] = (int)l_res_idx->ph;

                l_num_packs += l_res_idx->pw * l_res_idx->ph;
                p_cstr_info->tile[p_tile_no].pdx[i] = (int)l_tccp->prcw[i];
                p_cstr_info->tile[p_tile_no].pdy[i] = (int)l_tccp->prch[i];
            }
            p_cstr_info->tile[p_tile_no].packet = (opj_packet_info_t*) opj_calloc((
                    OPJ_SIZE_T)p_cstr_info->numcomps * (OPJ_SIZE_T)p_cstr_info->numlayers *
                                                  l_num_packs,
                                                  sizeof(opj_packet_info_t));
            if (!p_cstr_info->tile[p_tile_no].packet) {
        }
        /* << INDEX */

        /* FIXME _ProfStart(PGROUP_DC_SHIFT); */
        /*---------------TILE-------------------*/
        if (! opj_tcd_dc_level_shift_encode(p_tcd)) {
        /* FIXME _ProfStop(PGROUP_DC_SHIFT); */

        /* FIXME _ProfStart(PGROUP_MCT); */
        if (! opj_tcd_mct_encode(p_tcd)) {
        /* FIXME _ProfStop(PGROUP_MCT); */

        /* FIXME _ProfStart(PGROUP_DWT); */
        if (! opj_tcd_dwt_encode(p_tcd)) {
        /* FIXME  _ProfStop(PGROUP_DWT); */

        /* FIXME  _ProfStart(PGROUP_T1); */
        if (! opj_tcd_t1_encode(p_tcd)) {

/* src/lib/openjp2/tcd.c:2511 */
static OPJ_BOOL opj_tcd_t1_encode(opj_tcd_t *p_tcd)
{
    opj_t1_t * l_t1;
    const OPJ_FLOAT64 * l_mct_norms;
    OPJ_UINT32 l_mct_numcomps = 0U;
    opj_tcp_t * l_tcp = p_tcd->tcp;

    l_t1 = opj_t1_create(OPJ_TRUE);
    if (l_t1 == 00) {
        return OPJ_FALSE;
    }

    if (l_tcp->mct == 1) {
        l_mct_numcomps = 3U;
        /* irreversible encoding */
        if (l_tcp->tccps->qmfbid == 0) {
            l_mct_norms = opj_mct_get_mct_norms_real();
        } else {
            l_mct_norms = opj_mct_get_mct_norms();
        }
    } else {
        l_mct_numcomps = p_tcd->image->numcomps;
        l_mct_norms = (const OPJ_FLOAT64 *)(l_tcp->mct_norms);
    }

    if (! opj_t1_encode_cblks(l_t1, p_tcd->tcd_image->tiles, l_tcp, l_mct_norms,
                              l_mct_numcomps)) {

/* src/lib/openjp2/t1.c:2137 */
OPJ_BOOL opj_t1_encode_cblks(opj_t1_t *t1,
                             opj_tcd_tile_t *tile,
                             opj_tcp_t *tcp,
                             const OPJ_FLOAT64 * mct_norms,
                             OPJ_UINT32 mct_numcomps
                            )
{
    OPJ_UINT32 compno, resno, bandno, precno, cblkno;

    tile->distotile = 0;        /* fixed_quality */

    for (compno = 0; compno < tile->numcomps; ++compno) {
        opj_tcd_tilecomp_t* tilec = &tile->comps[compno];
        opj_tccp_t* tccp = &tcp->tccps[compno];
        OPJ_UINT32 tile_w = (OPJ_UINT32)(tilec->x1 - tilec->x0);

        for (resno = 0; resno < tilec->numresolutions; ++resno) {
            opj_tcd_resolution_t *res = &tilec->resolutions[resno];

            for (bandno = 0; bandno < res->numbands; ++bandno) {
                opj_tcd_band_t* OPJ_RESTRICT band = &res->bands[bandno];
                OPJ_INT32 bandconst;

                /* Skip empty bands */
                if (opj_tcd_is_band_empty(band)) {
                    continue;
                }

                bandconst = 8192 * 8192 / ((OPJ_INT32) floor(band->stepsize * 8192));
                for (precno = 0; precno < res->pw * res->ph; ++precno) {
                    opj_tcd_precinct_t *prc = &band->precincts[precno];

                    for (cblkno = 0; cblkno < prc->cw * prc->ch; ++cblkno) {
```
ì´ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ìˆ˜ë™ìœ¼ë¡œ Ksign ëª¨ë¸ì— ì ìš©í•´ì„œ ê²°ê³¼ë¥¼ íƒì§€í•´ë³´ì•˜ë”ë‹ˆ ì •ìƒìœ¼ë¡œ ì˜ˆì¸¡í–ˆë‹¤.


#### SARDëŠ” ì˜ íƒì§€í•˜ëŠ”ë° ì´ CVEëŠ” íƒì§€ ëª»í–ˆë˜ ì´ìœ 

1. **ìŠ¬ë¼ì´ìŠ¤ ì¶”ì¶œ ê¸°ì¤€ í•œê³„**

    - ë³¸ ì·¨ì•½ì ì€ `while (y < height)` ë°˜ë³µë¬¸ ë‚´ë¶€ì—ì„œ ë°œìƒí•˜ì§€ë§Œ,
    ìŠ¬ë¼ì´ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **í•¨ìˆ˜ í˜¸ì¶œ(CallExpression) ë‹¨ìœ„**ë¡œ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ìƒì„±.
    - ì´ ë•Œë¬¸ì— ë°˜ë³µë¬¸ ì „ì²´ íë¦„(ì¡°ê±´ ë³€ìˆ˜ `y`, `height` ê´€ê³„)ì€ ìŠ¬ë¼ì´ìŠ¤ì— í¬í•¨ë˜ì§€ ëª»í•˜ê³ ,
    `getc()` ë‹¨ì¼ í˜¸ì¶œ ë“± ë‹¨í¸ì  ë™ì‘ë§Œ ìŠ¬ë¼ì´ìŠ¤ë¡œ ìƒì„±ë¨.

        ê¸°ëŒ€í•˜ëŠ” ìŠ¬ë¼ì´ìŠ¤
        ```
        while (y < height) {
        int c = getc(IN);
        written++;
        }
        ```
        ì›ë³¸ ìŠ¬ë¼ì´ìŠ¤
        '''
        while (y < height) {\n",
        int c = getc(IN);
        '''
2. **ë°˜ë³µë¬¸ ì¡°ê±´ ë³€ìˆ˜ ì¶”ì  ì‹¤íŒ¨**

    - **`height`**: BMP íŒŒì¼ í—¤ë”ë¡œë¶€í„° ìœ ì…ëœ ì™¸ë¶€ ì…ë ¥ê°’.

    - **`y`**: ë””ì½”ë”© ê³¼ì •ì—ì„œ ë§¤ RLE ëª…ë ¹ì–´ì— ë”°ë¼ ì¦ê°€í•´ì•¼ ë£¨í”„ ì¢…ë£Œ ê°€ëŠ¥.

    - ì •ìƒ íë¦„

        `y`ê°€ ì •ìƒì ìœ¼ë¡œ ì¦ê°€ â†’ `y >= height`ê°€ ë˜ì–´ ë£¨í”„ ì¢…ë£Œ.

    - ë¹„ì •ìƒ íë¦„

        ì¡°ì‘ëœ RLE ëª…ë ¹ì–´ë¡œ ì¸í•´ `y`ê°€ ì¦ê°€í•˜ì§€ ì•ŠìŒ â†’ `y < height`ê°€ ì˜êµ¬íˆ ìœ ì§€ â†’ ë¬´í•œ ë£¨í”„ ë°œìƒ.


4. **íƒì§€ ëª¨ë¸ ì…ë ¥ ì •ë³´ ë¶€ì¡±**

    -  `vectors.json`ì„ ë¶„ì„í•œ ê²°ê³¼, ìŠ¬ë¼ì´ìŠ¤ input\_token ì‹œí€€ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‹¨í¸ì ì„:

        vectors.json (idx: 113)
 
        ```
        <s>, int, Var1, =, getc, (, Var2, ), ;, ...
        ```

      - ë¬¸ì œì : ë°˜ë³µë¬¸ êµ¬ì¡°(`while`), ì¢…ë£Œ ì¡°ê±´(`y < height`), ë°˜ë³µ ë³€ìˆ˜(`y`)ì™€ ì™¸ë¶€ ì…ë ¥
                  (`height`)ê´€ê³„ê°€ ëª¨ë¸ ì…ë ¥ì— ì œê³µë˜ì§€ ì•ŠìŒ.
      - ê²°ê³¼: ëª¨ë¸ì´ ë¬´í•œ ë£¨í”„ ê°€ëŠ¥ì„±ì„ í•™ìŠµí•  ìˆ˜ ì—†ìŒ.

## ì·¨ì•½ì  ì„¸ë¶€ ì‚¬í•­

### ğŸ“ ê´€ë ¨ íŒŒì¼ ì†Œê°œ

| íŒŒì¼ëª…                   | ì„¤ëª…             |
| :-------------------- | :------------- |
| `before_convertbmp.c` | ì·¨ì•½ ì½”ë“œ(ìˆ˜ì • ì „) í¬í•¨ |
| `after_convertbmp.c`  | ê°œì„  ì½”ë“œ(ìˆ˜ì • í›„) í¬í•¨ |

---

### â—ï¸ ì·¨ì•½ ì½”ë“œ

#### Source: BMP í—¤ë”ì—ì„œ ì…ë ¥ëœ `height` ê°’ (`before_convertbmp.c:546`)
#### Sink: ë¬´í•œ ë°˜ë³µ `getc(IN)` í˜¸ì¶œ (`before_convertbmp.c:547`)

```c
while (y < height) {               // (Line 546) ë°˜ë³µë¬¸ ì‹œì‘
    int c = getc(IN);              // (Line 547) Uncontrolled resource consumption
    ...
}
```

**ë¬¸ì œì **:

| ë³€ìˆ˜       | ì„¤ëª…                            |
| :------- | :---------------------------- |
| `height` | BMP í—¤ë”ë¡œë¶€í„° ì…ë ¥ëœ ì™¸ë¶€ ê°’ (ì¡°ì‘ ê°€ëŠ¥)    |
| `y`      | ë””ì½”ë”©ëœ ì¤„ ìˆ˜. ì •ìƒ RLE ëª…ë ¹ì–´ ì²˜ë¦¬ ì‹œ ì¦ê°€. |

    (ì •ìƒ íë¦„)

    ìœ íš¨í•œ RLE ëª…ë ¹ì–´ë¡œ `y` ê°’ì´ ì •ìƒì ìœ¼ë¡œ ì¦ê°€ â†’ `y >= height` â†’ ë£¨í”„ ì¢…ë£Œ.

    (ë¹„ì •ìƒ íë¦„)

    ì¡°ì‘ëœ RLE ëª…ë ¹ì–´ë¡œ ì¸í•´ `y` ê°’ì´ ì¦ê°€í•˜ì§€ ì•ŠìŒ â†’ `y < height` ì˜êµ¬ ìœ ì§€ â†’ ë¬´í•œ ë£¨í”„ ë°œìƒ.

---

### âœ… ê°œì„  ì½”ë“œ
**íŒ¨ì¹˜ ìœ„ì¹˜**: `after_convertbmp.c:614`

```c
if (written != width * height) {
    fprintf(stderr, "warning, image's actual size does not match advertised one\n");
    return OPJ_FALSE;
}
```

**ê°œì„  ë°©ë²•**:

* ì‹¤ì œ ë””ì½”ë”©ëœ í”½ì…€ ìˆ˜(`written`)ë¥¼ ë³„ë„ ì¹´ìš´íŠ¸.
* ë£¨í”„ ì¢…ë£Œ í›„ í—¤ë”ì— ëª…ì‹œëœ ì´ë¯¸ì§€ í¬ê¸°(`width * height`)ì™€ ë¹„êµ.
* ë¶ˆì¼ì¹˜ ì‹œ ë¹„ì •ìƒ íŒŒì¼ë¡œ íŒë‹¨í•˜ê³  ë””ì½”ë”© ì¤‘ë‹¨.

---

## íƒì§€ ê²°ê³¼


| FileName | Caller               | Source | Sink  | idx | CWE-ID | category       | criterion | line | label | token_length | predict |
|----------|----------------------|--------|-------|-----|--------|----------------|-----------|------|-------|--------------|---------|
| before.c | bmp_read_file_header | False  | False | 0   | CWE-   | CallExpression | getc      | 330  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 1   | CWE-   | CallExpression | getc      | 331  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 2   | CWE-   | CallExpression | fprintf   | 334  | -3    | 23           | 0       |
| before.c | bmp_read_file_header | False  | False | 3   | CWE-   | CallExpression | getc      | 340  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 4   | CWE-   | CallExpression | getc      | 341  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 5   | CWE-   | CallExpression | getc      | 342  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 6   | CWE-   | CallExpression | getc      | 343  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 7   | CWE-   | CallExpression | getc      | 345  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 8   | CWE-   | CallExpression | getc      | 346  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 9   | CWE-   | CallExpression | getc      | 348  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 10  | CWE-   | CallExpression | getc      | 349  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 11  | CWE-   | CallExpression | getc      | 351  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 12  | CWE-   | CallExpression | getc      | 352  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 13  | CWE-   | CallExpression | getc      | 353  | -3    | 343          | 0       |
| before.c | bmp_read_file_header | False  | False | 14  | CWE-   | CallExpression | getc      | 354  | -3    | 343          | 0       |
| before.c | bmp_read_info_header | False  | False | 15  | CWE-   | CallExpression | memset    | 359  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 16  | CWE-   | CallExpression | getc      | 362  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 17  | CWE-   | CallExpression | getc      | 363  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 18  | CWE-   | CallExpression | getc      | 364  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 19  | CWE-   | CallExpression | getc      | 365  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 20  | CWE-   | CallExpression | fprintf   | 376  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 21  | CWE-   | CallExpression | getc      | 380  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 22  | CWE-   | CallExpression | getc      | 381  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 23  | CWE-   | CallExpression | getc      | 382  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 24  | CWE-   | CallExpression | getc      | 383  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 25  | CWE-   | CallExpression | getc      | 385  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 26  | CWE-   | CallExpression | getc      | 386  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 27  | CWE-   | CallExpression | getc      | 387  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 28  | CWE-   | CallExpression | getc      | 388  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 29  | CWE-   | CallExpression | getc      | 390  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 30  | CWE-   | CallExpression | getc      | 391  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 31  | CWE-   | CallExpression | getc      | 393  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 32  | CWE-   | CallExpression | getc      | 394  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 33  | CWE-   | CallExpression | fprintf   | 396  | -3    | 35           | 0       |
| before.c | bmp_read_info_header | False  | False | 34  | CWE-   | CallExpression | getc      | 401  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 35  | CWE-   | CallExpression | getc      | 402  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 36  | CWE-   | CallExpression | getc      | 403  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 37  | CWE-   | CallExpression | getc      | 404  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 38  | CWE-   | CallExpression | getc      | 406  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 39  | CWE-   | CallExpression | getc      | 407  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 40  | CWE-   | CallExpression | getc      | 408  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 41  | CWE-   | CallExpression | getc      | 409  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 42  | CWE-   | CallExpression | getc      | 411  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 43  | CWE-   | CallExpression | getc      | 412  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 44  | CWE-   | CallExpression | getc      | 413  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 45  | CWE-   | CallExpression | getc      | 414  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 46  | CWE-   | CallExpression | getc      | 416  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 47  | CWE-   | CallExpression | getc      | 417  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 48  | CWE-   | CallExpression | getc      | 418  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 49  | CWE-   | CallExpression | getc      | 419  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 50  | CWE-   | CallExpression | getc      | 421  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 51  | CWE-   | CallExpression | getc      | 422  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 52  | CWE-   | CallExpression | getc      | 423  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 53  | CWE-   | CallExpression | getc      | 424  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 54  | CWE-   | CallExpression | getc      | 426  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 55  | CWE-   | CallExpression | getc      | 427  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 56  | CWE-   | CallExpression | getc      | 428  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 57  | CWE-   | CallExpression | getc      | 429  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 58  | CWE-   | CallExpression | getc      | 433  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 59  | CWE-   | CallExpression | getc      | 434  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 60  | CWE-   | CallExpression | getc      | 435  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 61  | CWE-   | CallExpression | getc      | 436  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 62  | CWE-   | CallExpression | fprintf   | 439  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 63  | CWE-   | CallExpression | getc      | 443  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 64  | CWE-   | CallExpression | getc      | 444  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 65  | CWE-   | CallExpression | getc      | 445  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 66  | CWE-   | CallExpression | getc      | 446  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 67  | CWE-   | CallExpression | fprintf   | 449  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 68  | CWE-   | CallExpression | getc      | 453  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 69  | CWE-   | CallExpression | getc      | 454  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 70  | CWE-   | CallExpression | getc      | 455  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 71  | CWE-   | CallExpression | getc      | 456  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 72  | CWE-   | CallExpression | fprintf   | 459  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 73  | CWE-   | CallExpression | getc      | 463  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 74  | CWE-   | CallExpression | getc      | 464  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 75  | CWE-   | CallExpression | getc      | 465  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 76  | CWE-   | CallExpression | getc      | 466  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 77  | CWE-   | CallExpression | getc      | 470  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 78  | CWE-   | CallExpression | getc      | 471  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 79  | CWE-   | CallExpression | getc      | 472  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 80  | CWE-   | CallExpression | getc      | 473  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 81  | CWE-   | CallExpression | fread     | 475  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 82  | CWE-   | CallExpression | fprintf   | 477  | -3    | 147          | 0       |
| before.c | bmp_read_info_header | False  | False | 83  | CWE-   | CallExpression | getc      | 481  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 84  | CWE-   | CallExpression | getc      | 482  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 85  | CWE-   | CallExpression | getc      | 483  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 86  | CWE-   | CallExpression | getc      | 484  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 87  | CWE-   | CallExpression | getc      | 486  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 88  | CWE-   | CallExpression | getc      | 487  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 89  | CWE-   | CallExpression | getc      | 488  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 90  | CWE-   | CallExpression | getc      | 489  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 91  | CWE-   | CallExpression | getc      | 491  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 92  | CWE-   | CallExpression | getc      | 492  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 93  | CWE-   | CallExpression | getc      | 493  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 94  | CWE-   | CallExpression | getc      | 494  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 95  | CWE-   | CallExpression | getc      | 498  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 96  | CWE-   | CallExpression | getc      | 499  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 97  | CWE-   | CallExpression | getc      | 500  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 98  | CWE-   | CallExpression | getc      | 501  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 99  | CWE-   | CallExpression | getc      | 503  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 100 | CWE-   | CallExpression | getc      | 504  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 101 | CWE-   | CallExpression | getc      | 505  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 102 | CWE-   | CallExpression | getc      | 506  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 103 | CWE-   | CallExpression | getc      | 508  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 104 | CWE-   | CallExpression | getc      | 509  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 105 | CWE-   | CallExpression | getc      | 510  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 106 | CWE-   | CallExpression | getc      | 511  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 107 | CWE-   | CallExpression | getc      | 513  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 108 | CWE-   | CallExpression | getc      | 514  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 109 | CWE-   | CallExpression | getc      | 515  | -3    | 2126         | 0       |
| before.c | bmp_read_info_header | False  | False | 110 | CWE-   | CallExpression | getc      | 516  | -3    | 2126         | 0       |
| before.c | bmp_read_raw_data    | False  | False | 111 | CWE-   | CallExpression | fread     | 526  | -3    | 54           | 0       |
| before.c | bmp_read_raw_data    | False  | False | 112 | CWE-   | CallExpression | fprintf   | 527  | -3    | 48           | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 113 | CWE-   | CallExpression | getc      | 546  | -3    | 469          | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 114 | CWE-   | CallExpression | getc      | 555  | -3    | 554          | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 115 | CWE-   | CallExpression | getc      | 566  | -3    | 469          | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 116 | CWE-   | CallExpression | getc      | 578  | -3    | 661          | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 117 | CWE-   | CallExpression | getc      | 583  | -3    | 661          | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 118 | CWE-   | CallExpression | getc      | 595  | -3    | 487          | 0       |
| before.c | bmp_read_rle8_data   | False  | False | 119 | CWE-   | CallExpression | getc      | 603  | -3    | 469          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 120 | CWE-   | CallExpression | getc      | 625  | -3    | 454          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 121 | CWE-   | CallExpression | getc      | 632  | -3    | 565          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 122 | CWE-   | CallExpression | getc      | 639  | -3    | 454          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 123 | CWE-   | CallExpression | getc      | 651  | -3    | 688          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 124 | CWE-   | CallExpression | getc      | 653  | -3    | 695          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 125 | CWE-   | CallExpression | getc      | 663  | -3    | 565          | 0       |
| before.c | bmp_read_rle4_data   | False  | False | 126 | CWE-   | CallExpression | getc      | 668  | -3    | 426          | 0       |
| before.c | bmptoimage           | False  | False | 127 | CWE-   | CallExpression | fopen     | 694  | -3    | 929          | 0       |
| before.c | bmptoimage           | False  | False | 128 | CWE-   | CallExpression | fprintf   | 696  | -3    | 63           | 0       |
| before.c | bmptoimage           | False  | False | 129 | CWE-   | CallExpression | fclose    | 701  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 130 | CWE-   | CallExpression | fclose    | 705  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 131 | CWE-   | CallExpression | memset    | 711  | -3    | 255          | 0       |
| before.c | bmptoimage           | False  | False | 132 | CWE-   | CallExpression | memset    | 712  | -3    | 255          | 0       |
| before.c | bmptoimage           | False  | False | 133 | CWE-   | CallExpression | memset    | 713  | -3    | 255          | 0       |
| before.c | bmptoimage           | False  | False | 134 | CWE-   | CallExpression | getc      | 725  | -3    | 795          | 0       |
| before.c | bmptoimage           | False  | False | 135 | CWE-   | CallExpression | getc      | 726  | -3    | 795          | 0       |
| before.c | bmptoimage           | False  | False | 136 | CWE-   | CallExpression | getc      | 727  | -3    | 960          | 0       |
| before.c | bmptoimage           | False  | False | 137 | CWE-   | CallExpression | getc      | 728  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 138 | CWE-   | CallExpression | fclose    | 743  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 139 | CWE-   | CallExpression | fclose    | 748  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 140 | CWE-   | CallExpression | fclose    | 756  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 141 | CWE-   | CallExpression | fclose    | 763  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 142 | CWE-   | CallExpression | calloc    | 766  | -3    | 1349         | 0       |
| before.c | bmptoimage           | False  | False | 143 | CWE-   | CallExpression | fclose    | 768  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 144 | CWE-   | CallExpression | fprintf   | 793  | -3    | 283          | 0       |
| before.c | bmptoimage           | False  | False | 145 | CWE-   | CallExpression | free      | 798  | -3    | 954          | 0       |
| before.c | bmptoimage           | False  | False | 146 | CWE-   | CallExpression | fclose    | 799  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 147 | CWE-   | CallExpression | memset    | 804  | -3    | 518          | 0       |
| before.c | bmptoimage           | False  | False | 148 | CWE-   | CallExpression | fclose    | 818  | -3    | 706          | 0       |
| before.c | bmptoimage           | False  | False | 149 | CWE-   | CallExpression | free      | 819  | -3    | 954          | 0       |
| before.c | bmptoimage           | False  | False | 150 | CWE-   | CallExpression | fprintf   | 871  | -3    | 1242         | 0       |
| before.c | bmptoimage           | False  | False | 151 | CWE-   | CallExpression | free      | 875  | -3    | 954          | 0       |
| before.c | bmptoimage           | False  | False | 152 | CWE-   | CallExpression | fclose    | 876  | -3    | 706          | 0       |
| before.c | imagetobmp           | False  | False | 153 | CWE-   | CallExpression | fprintf   | 888  | -3    | 1148         | 0       |
| before.c | imagetobmp           | False  | False | 154 | CWE-   | CallExpression | fopen     | 905  | -3    | 2441         | 0       |
| before.c | imagetobmp           | False  | False | 155 | CWE-   | CallExpression | fprintf   | 907  | -3    | 355          | 0       |
| before.c | imagetobmp           | False  | False | 156 | CWE-   | CallExpression | fprintf   | 914  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 157 | CWE-   | CallExpression | fprintf   | 918  | -3    | 1565         | 0       |
| before.c | imagetobmp           | False  | False | 158 | CWE-   | CallExpression | fprintf   | 923  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 159 | CWE-   | CallExpression | fprintf   | 925  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 160 | CWE-   | CallExpression | fprintf   | 930  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 161 | CWE-   | CallExpression | fprintf   | 932  | -3    | 1544         | 0       |
| before.c | imagetobmp           | False  | False | 162 | CWE-   | CallExpression | fprintf   | 936  | -3    | 1544         | 0       |
| before.c | imagetobmp           | False  | False | 163 | CWE-   | CallExpression | fprintf   | 940  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 164 | CWE-   | CallExpression | fprintf   | 941  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 165 | CWE-   | CallExpression | fprintf   | 942  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 166 | CWE-   | CallExpression | fprintf   | 944  | -3    | 1565         | 0       |
| before.c | imagetobmp           | False  | False | 167 | CWE-   | CallExpression | fprintf   | 948  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 168 | CWE-   | CallExpression | fprintf   | 950  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 169 | CWE-   | CallExpression | fprintf   | 952  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 170 | CWE-   | CallExpression | fprintf   | 954  | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 171 | CWE-   | CallExpression | fprintf   | 1019 | -3    | 2090         | 0       |
| before.c | imagetobmp           | False  | False | 172 | CWE-   | CallExpression | fprintf   | 1023 | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 173 | CWE-   | CallExpression | fclose    | 1027 | -3    | 1352         | 0       |
| before.c | imagetobmp           | False  | False | 174 | CWE-   | CallExpression | fopen     | 1034 | -3    | 2441         | 0       |
| before.c | imagetobmp           | False  | False | 175 | CWE-   | CallExpression | fprintf   | 1036 | -3    | 355          | 0       |
| before.c | imagetobmp           | False  | False | 176 | CWE-   | CallExpression | fprintf   | 1040 | -3    | 1148         | 0       |
| before.c | imagetobmp           | False  | False | 177 | CWE-   | CallExpression | fprintf   | 1046 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 178 | CWE-   | CallExpression | fprintf   | 1050 | -3    | 1463         | 0       |
| before.c | imagetobmp           | False  | False | 179 | CWE-   | CallExpression | fprintf   | 1054 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 180 | CWE-   | CallExpression | fprintf   | 1056 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 181 | CWE-   | CallExpression | fprintf   | 1062 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 182 | CWE-   | CallExpression | fprintf   | 1064 | -3    | 1442         | 0       |
| before.c | imagetobmp           | False  | False | 183 | CWE-   | CallExpression | fprintf   | 1068 | -3    | 1442         | 0       |
| before.c | imagetobmp           | False  | False | 184 | CWE-   | CallExpression | fprintf   | 1072 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 185 | CWE-   | CallExpression | fprintf   | 1073 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 186 | CWE-   | CallExpression | fprintf   | 1074 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 187 | CWE-   | CallExpression | fprintf   | 1076 | -3    | 1463         | 0       |
| before.c | imagetobmp           | False  | False | 188 | CWE-   | CallExpression | fprintf   | 1080 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 189 | CWE-   | CallExpression | fprintf   | 1082 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 190 | CWE-   | CallExpression | fprintf   | 1084 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 191 | CWE-   | CallExpression | fprintf   | 1086 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 192 | CWE-   | CallExpression | fprintf   | 1098 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 193 | CWE-   | CallExpression | fprintf   | 1115 | -3    | 1634         | 0       |
| before.c | imagetobmp           | False  | False | 194 | CWE-   | CallExpression | fprintf   | 1119 | -3    | 1370         | 0       |
| before.c | imagetobmp           | False  | False | 195 | CWE-   | CallExpression | fclose    | 1123 | -3    | 1370         | 0       |

