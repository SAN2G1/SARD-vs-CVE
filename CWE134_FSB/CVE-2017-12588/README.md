# 📁 CVE-2017-12588

## 🔍 취약점 개요

**🔗 [커밋 링크](https://github.com/rsyslog/rsyslog/commit/062d0c671a29f7c6f7dff4a2f1f35df375bbb30b)** | **🔗 [CVE 링크](https://www.cvedetails.com/cve/CVE-2017-12588/)**  | **🔗 [CWE 링크](https://cwe.mitre.org/data/definitions/134.html)**  


> rsyslog 8.28.0 이전 버전의 `omzmq3` 및 `imzmq3` 모듈에서는 설명(description) 필드가 형식 문자열로 해석되는 문제가 존재합니다.  
> 이로 인해 공격자는 포맷 문자열 지정자를 포함한 입력을 통해 **형식 문자열 취약점(CWE-134)**을 유발할 수 있으며, 이는 서비스 거부 또는 메모리 조작과 같은 영향을 초래할 수 있습니다.

* **Source**: 설명 문자열(`info->description`) – 외부 입력에 의해 설정될 수 있음
* **취약 조건**: 설명(description) 문자열에 포맷 문자열 지정자(`%s`, `%x` 등)가 포함된 경우, 해당 문자열이 포맷 문자열로 직접 사용됨
* **Sink**: `zsocket_connect()`, `zsocket_bind()` – 내부적으로 `printf` 계열 함수에 format string으로 전달됨

---

## 탐지 결과 요약

| 총 슬라이스 수 | 취약으로 탐지 | 정상으로 탐지 |
|----------------|----------------|----------------|
| 0개           | 0개            | 0개           |

\* Sink(`zsocket_connect` 함수) 관련 슬라이스는 존재하지 않음.

---

#### SARD는 잘 탐지하는데 이 CVE는 탐지 못했던 이유

1. **부적절한 criterion**
   * 이 취약점의 경우 criterion으로 `zsocket_connect`이 잡히지 않아 정상으로 판단된 것으로 보임.

---

## 취약점 세부 사항

### ❗️취약 코드

#### Sink: `before_omzmq3.c:252`

```c
if(-1 == zsocket_connect(pData->socket, (char*)pData->description))
```

**문제점**:
* `info->description`은 외부 설정 파일 또는 입력을 통해 유입되는 사용자 제어 가능 문자열입니다.
* 해당 값이 포맷 문자열 자리에 직접 들어가므로, `%s`, `%x` 등의 포맷 지정자가 포함될 경우
  형식 문자열 취약점(CWE-134) 발생 가능

### ✅ 개선 코드

**패치 위치**: `after_omzmq3.c:252`

```c
if(-1 == zsocket_connect(pData->socket, "%s", (char*)pData->description))
```

**개선 방법**:

* 포맷 문자열을 고정된 `"%s"`로 명시하여 외부 입력이 포맷으로 해석되지 않도록 조치
* 사용자 입력은 포맷 문자열의 인자(`"%s"`, `"%d"` 등)에만 전달되도록 구성해야 하며, **포맷 문자열 자체로 사용되어서는 안 됨**
#### 포맷 문자열: `"%s"`, `"%d"`, `"%x"` 같은 출력 형식 명령이 들어있는 문자열로, `sprintf`류 함수의 두 번째 인자로 쓰이는 문자열
#### `printf`, `sprintf`, `fprintf` 같은 함수의 두 번째 인자로 `user_input`이 들어가면 안된다는 의미

---

## 탐지 결과
\* cve 설명에 나온 취약한 함수(Caller)에 대한 슬라이스 관련 데이터만 추출
* 없음