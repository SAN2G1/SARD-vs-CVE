[
  {
    "FileName": "after_file-xfers.c",
    "Caller": "vdagent_file_xfers_data",
    "Source": false,
    "Sink": false,
    "idx": 0,
    "CWE-ID": "CWE-",
    "category": "CallExpression",
    "criterion": "syslog",
    "line": 23,
    "label": -3,
    "slices": [
                "static gboolean vdagent_init_async_cb(gpointer user_data)\n",
                "{\n",
                "    VDAgent *agent = user_data;\n",
                "    GError *err = NULL;\n",
                "    agent->conn = udscs_connect(vdagentd_socket,\n",
                "                                daemon_read_complete,\n",
                "                                daemon_error_cb,\n",
                "                                debug,\n",
                "                                &err);\n",
                "}\n",
                "static void daemon_read_complete(UdscsConnection *conn,\n",
                "    struct udscs_message_header *header, uint8_t *data)\n",
                "{\n",
                "    VDAgent *agent = g_object_get_data(G_OBJECT(conn), \"agent\");\n",
                "\n",
                "    switch (header->type) {\n",
                "        ...\n",
                "        case VDAGENTD_FILE_XFER_DATA:\n",
                "        if (agent->xfers != NULL) {\n",
                "            vdagent_file_xfers_data(agent->xfers,\n",
                "                                    (VDAgentFileXferDataMessage *)data);\n",
                "        }\n",
                "}\n",
                "void vdagent_file_xfers_data(struct vdagent_file_xfers *xfers,\n",
                "    VDAgentFileXferDataMessage *msg)\n",
                "{\n",
                "    AgentFileXferTask *task;\n",
                "    int len, status = -1;\n",
                "    task = vdagent_file_xfers_get_task(xfers, msg->id);\n",
                "    len = write(task->file_fd, msg->data, msg->size);\n",
                "    if (len == msg->size) {\n",
                "        task->read_bytes += msg->size;\n",
                "        if (task->read_bytes >= task->file_size) {\n",
                "            if (task->read_bytes == task->file_size) {\n",
                "                if (xfers->debug)\n",
                "                    syslog(LOG_DEBUG, \"file-xfer: task %u %s has completed\",\n",
                "                           task->id, task->file_name);\n",
                "                close(task->file_fd);\n",
                "                task->file_fd = -1;\n",
                "                if (xfers->open_save_dir &&\n",
                "                        task->file_xfer_nr == task->file_xfer_total &&\n",
                "                        g_hash_table_size(xfers->xfers) == 1) {\n",
                "                    char buf[PATH_MAX];\n",
                "                    snprintf(buf, PATH_MAX, \"xdg-open '%s'&\", xfers->save_dir);\n",
                "                    status = system(buf);\n"
            ]
    }
]
